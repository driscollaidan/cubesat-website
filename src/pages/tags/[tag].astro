---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro"; 
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = (await getCollection('posts')).filter(p => !p.data.draft);
  const tags = Array.from(new Set(posts.flatMap(p => p.data.tags ?? [])));
  return tags.map(tag => ({ params: { tag } }));
}

const { tag } = Astro.params;

const posts = (await getCollection('posts'))
  .filter(p => !p.data.draft && (p.data.tags ?? []).includes(tag))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());
---

<BaseLayout title={`Posts tagged "${tag}" | Purdue APEx CubeSat`}>
  <section class="main-content posts-section">
    <h1 class="posts-title">Posts tagged <span class="tag-highlight">#{tag}</span></h1>

    {posts.length === 0 ? (
      <p>No posts found for this tag.</p>
    ) : (
      posts.map(post => <PostCard post={post} />)
    )}
  </section>
</BaseLayout>

<style>
.posts-title {
  font-size: 2rem;
  font-weight: 600;
  margin-bottom: 1.5rem;
  text-align: center;
  color: #111827;
  border-bottom: 2px dotted var(--accent, #ff6b4a);
  padding-bottom: 0.5rem;
}

.tag-highlight {
  color: var(--accent, #ff6b4a);
  font-weight: 700;
}
</style>